<div>
  <h1 class="display-3">Predikcie</h1>


  <h2 id="general-info" class="section-header" padding>Spustenie predikcie</h2>
  <div class="row">
    <div class="col-lg-4">
      <form>
        <mat-form-field>
          <mat-label>Rok nastupu: </mat-label>
          <input matInput type="text" placeholder="RRRR-RRRR" [formControl]="school_year" pattern="[0-9]{4}-[0-9]{4}"
            required />
          <mat-error *ngIf="school_year.errors">
            Zadajte rok vo formáte RRRR-RRRR.
          </mat-error>
        </mat-form-field>
        <br>

        <mat-form-field>
          <mat-label>Predmet: </mat-label>
          <mat-select name="subject" [(ngModel)]="selected_subject" (ngModelChange)="onFormChange()">
            <mat-option *ngFor="let subject of imported_subjects" [value]="subject">
              {{ subject }}
            </mat-option>
          </mat-select>
        </mat-form-field>
        <br>

        <mat-form-field *ngIf="show_models">
          <mat-label>Model: </mat-label>
          <mat-select [(value)]="selected_model">
            <mat-option *ngFor="let model of available_models" [value]="model">
              {{ model.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </form>

      <button mat-raised-button color="primary" (click)="start_prediction()" [disabled]="school_year.errors">
        SPUSTI PREDIKCIU
      </button>

      <br>
      <br>

      <h3 *ngIf="model_details"> Metriky použitého modelu</h3>
      
      <table class="table" *ngIf="model_details">
        <tbody>
          <tr>
            <th>správnosť (accuracy) </th>
            <td>{{model_details.accuracy}}</td>
          </tr>
          <tr>
            <th>pokrytie (recall) </th>
            <td>{{model_details.recall}}</td>
          </tr>
          <tr>
            <th>presnosť (precision) </th>
            <td>{{model_details.precision}}</td>
          </tr>
          <tr>
            <th>f1 makro</th>
            <td>{{model_details.f1}}</td>
          </tr>

        </tbody>
      </table>

    </div>

    <div class="col-lg-8">



      <div flex flex-column margin-top>
        <div *ngIf="showErrorMessage" class="alert alert-danger mt-3" role="alert" flex align-items-center>
          <div class="icon-wrapper danger" margin-right>
            <i class="far fa-times-circle"></i>
          </div>
          Pri spúšťaní predikcie nastala chyba. {{ErrorMessage}}
        </div>



      </div>

      <h3 *ngIf="risky_students">Študenti identifikovaní ako rizikoví</h3>

      <div class=row>
        <div class="col-sm-8">
          <mat-form-field [hidden]="!risky_students">
            <mat-label>Filter</mat-label>
            <input matInput (keyup)="applyFilter($event)" placeholder="">
          </mat-form-field>
        </div>
        <div class="flow-md-right" class="col-sm-4"> 
          <button *ngIf="risky_students" mat-raised-button color="primary" (click)="export_data_excel()">
            Exportuj podrobnejšie údaje
          </button>
          
        </div>
      </div>

      <table mat-table *ngIf="risky_students" [dataSource]="data_source_risky_students" class="mat-elevation-z8">
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef> id </th>
          <td mat-cell *matCellDef="let element"> {{element.AIS_ID}} </td>
        </ng-container>
        <ng-container matColumnDef="meno">
          <th mat-header-cell *matHeaderCellDef> meno </th>
          <td mat-cell *matCellDef="let element"> {{element.Meno}} </td>
        </ng-container>
        <ng-container matColumnDef="priezvisko">
          <th mat-header-cell *matHeaderCellDef> priezvisko </th>
          <td mat-cell *matCellDef="let element"> {{element.Priezvisko}} </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayed_columns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayed_columns"></tr>
      </table>
      <mat-paginator [hidden]="!risky_students" [pageSize]="10" [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons>
      </mat-paginator>
    </div>
  </div>

</div>

<app-model-import></app-model-import>
<app-model-create></app-model-create>