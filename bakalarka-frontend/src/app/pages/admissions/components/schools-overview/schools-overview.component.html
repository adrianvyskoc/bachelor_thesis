<h2 id="schools-overview" class="section-header" padding>Prehľad škôl v krajine</h2>

<div class="schoolMap">

  <div class="schoolMap__filter" flex margin-bottom>
    <select
      [(ngModel)]="schoolsToShow"
      class="custom-select"
      name="schoolsToShow"
      margin-right
      (change)="filterSchools($event)"
    >
      <option value="all">Všetky školy</option>
      <option value="some">Máme prihlášky</option>
      <option value="none">Nemáme prihlášky</option>
    </select>

    <select
      [(ngModel)]="schoolQuality"
      class="custom-select"
      name="schoolQuality"
      margin-right
      (change)="filterSchools($event)"
    >
      <option value="all">Všetky</option>
      <option value="high">Výborné výsledky žiakov</option>
      <option value="medium">Priemerné výsledky žiakov</option>
      <option value="low">Zlé výsledky žiakov</option>
      <option value="none">Neuvedené</option>
    </select>

    <input
      [(ngModel)]="filteredSchoolId"
      class="form-control"
      placeholder="Kód školy"
      type="text"
      (ngModelChange)="onFilterSchoolsBySchoolId($event)"
    >
    <input
      [(ngModel)]="filteredSchoolStreet"
      class="form-control"
      placeholder="Ulica školy"
      type="text"
      margin-left
      (ngModelChange)="onFilterSchoolsByStreet($event)"
    >
  </div>

  <div flex>
    <app-map
      [markers]="filteredSchools"
      [height]="600"
      (selectMarker)="onSchoolChoose($event)"
    ></app-map>
    <div
      *ngIf="chosenSchool"
      class="schoolMap__schoolDetail"
      padding
    >
      <div class="schoolMap__schoolDetail__closeButton" (click)="closeChosenSchoolWindow()">
          <i class="fas fa-times"></i>
      </div>
      <h3>{{ chosenSchool.nazov }}</h3>
      <hr>
      <table class="table table-borderless table-sm">
        <thead>
          <tr>
            <th colspan="2" scope="col">Všeobecné informácie o škole</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th scope="row">Kód školy</th>
            <td>{{ chosenSchool.kod_kodsko }}</td>
          </tr>
          <tr>
            <th scope="row">Typ školy</th>
            <td>{{ chosenSchool.typ_skoly }}</td>
          </tr>
          <tr>
            <th scope="row">Email</th>
            <td>{{ chosenSchool.email }}</td>
          </tr>
          <tr>
            <th scope="row">Počet prihlášok z danej školy</th>
            <td>{{ chosenSchool.admissions.data.length }}</td>
          </tr>
          <tr>
            <th scope="row">Celkové hodnotenie školy</th>
            <td>{{ chosenSchool.celkove_hodnotenie ? chosenSchool.celkove_hodnotenie : 'Neuvedené' }}</td>
          </tr>
        </tbody>
      </table>

      <app-chart
        *ngIf="chosenSchool.admissions.data.length"
        [legend]="false"
        [type]="'bar'"
        [data]="[chosenSchool.beganStudy, chosenSchool.approved, chosenSchool.rejected]"
        [labels]="['Nastúpený', 'Prijatý', 'Neprijatý']"
      ></app-chart>
    </div>
  </div>

  <div *ngIf="chosenSchool && chosenSchool.admissions.data.length" margin-top>
    <table mat-table matSort [dataSource]="chosenSchool.admissions" full-width>
      <ng-container [matColumnDef]="column" *ngFor="let column of displayedAdmissionsColumns">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> {{column}} </th>
        <td mat-cell *matCellDef="let element"> {{element[column]}} </td>
      </ng-container>

      <ng-container matColumnDef="Rozh" stickyEnd>
        <th mat-header-cell *matHeaderCellDef> Rozhodnutie o prijatí </th>
        <td [ngStyle]="{ color: element.Rozh > 9 && element.Rozh < 20 ? 'green' : 'red' }" mat-cell *matCellDef="let element">
          {{ isAccepted(element.Rozh) }}
        </td>
      </ng-container>

      <ng-container matColumnDef="Akcie" stickyEnd>
        <th mat-header-cell *matHeaderCellDef> Akcie </th>
        <td mat-cell *matCellDef="let element">
          <button class="btn btn-primary" [routerLink]="['bachelor', element.id]" no-margin>Detail</button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="_displayedColumnsAndActions()"></tr>
      <tr mat-row *matRowDef="let row; columns: _displayedColumnsAndActions();"></tr>
    </table>
    <mat-paginator [pageSizeOptions]="[10, 20, 50, 100]" showFirstLastButtons #paginator></mat-paginator>
  </div>

  <div
    *ngIf="chosenSchool && !chosenSchool.admissions.data.length"
    margin-top
    text-center
  >
    <hr>
    Z tejto školy zatiaľ neexistujú žiadne prihlášky.
  </div>

</div>
